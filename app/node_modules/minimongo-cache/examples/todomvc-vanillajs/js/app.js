/*global app, $on */
(function () {
	'use strict';

  var minimongo = require('minimongo');

	/**
	 * Sets up a brand new Todo list.
	 *
	 * @param {string} name The name of your new to do list.
	 */
	function Todo(name) {
    this.model = minimongo.deserialize(
      JSON.parse(window.localStorage.getItem('todomvc-vanillajs') || 'null')
    );
    this.model.on('change', function() {
      window.localStorage.setItem('todomvc-react', JSON.stringify(this.model.serialize()));
    }.bind(this));
    this.model.addCollection('todos');

		this.template = new app.Template();
		this.view = new app.View(this.template);
		this.controller = new app.Controller(this.model, this.view);
	}

	var todo = new Todo('todos-vanillajs');

	function setView() {
		todo.controller.setView(document.location.hash);
	}
	$on(window, 'load', setView);
	$on(window, 'hashchange', setView);
})();
